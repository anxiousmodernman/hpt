{
    "variables": {
        "do_api_token": "{{ env `DIGITALOCEAN_API_TOKEN` }}",
        "hpt_config": "base.toml",
        "region": "sfo2",
        "local_repo": "/home/tester/go/src/github.com/anxiousmodernman/hpt"
    },
    "builders": [
        {
            "type": "digitalocean",
            "image": "centos-7-x64",
            "snapshot_name": "hpt-test-{{ timestamp }}",
            "region": "{{ user `region` }}",
            "size": "512mb",
            "ssh_username": "root",
            "api_token": "{{ user `do_api_token` }}"
        }
    ],
    "provisioners": [
        {
            "type": "shell",
            "execute_command": "echo {{user `ssh_username`}} | {{ .Vars }} sudo -E -S sh '{{ .Path }}'",
            "inline": [
                "mkdir -p /home/tester/go/bin",
                "mkdir -p {{ user `local_repo` }}/vendor",
                "yum install -y git wget unzip",
                "cd {{ user `local_repo` }}",
                "echo GIT IS $(which git)",
                "git clone https://github.com/anxiousmodernman/hpt",
                "echo whe are here $(pwd)",
                "ls",
                "echo inside!!!!",
                "ls hpt",
                "cd /tmp",
                "wget --progress=dot:mega https://dl.google.com/go/go1.10.linux-amd64.tar.gz",
                "tar -C /usr/local -xzf go1.10.linux-amd64.tar.gz",
                "ln -s /usr/local/go/bin/go /usr/bin/go",
                "export GOPATH=/home/tester/go",
                "export PATH=$PATH:/home/tester/hpt/go/bin",
                "cd /tmp",
                "mkdir protobuf",
                "wget --progress=dot:mega https://github.com/golang/dep/releases/download/v0.4.1/dep-linux-amd64",
                "chmod +x dep-linux-amd64",
                "ls",
                "mv dep-linux-amd64 /home/tester/go/bin/dep",
                "echo wtffffff",
                "ls /home/tester/go/bin",
                "wget -P --progress=dot:mega /tmp/protobuf https://github.com/google/protobuf/releases/download/v3.5.0/protoc-3.5.0-linux-x86_64.zip",
                "cd protobuf",
                "unzip protoc-3.5.0-linux-x86_64.zip",
                "ls /tmp/protobuf/bin",
                "sudo mv /tmp/protobuf/bin/protoc /bin",
                "cd {{ user `local_repo` }}",
                "ls",
                "/home/tester/go/bin/dep ensure",
                "./gen.sh",
                "/usr/local/go/bin/go build"
            ]
        },
        {
            "type": "shell",
            "execute_command": "echo {{user `ssh_username`}} | {{ .Vars }} sudo -E -S sh '{{ .Path }}'",
            "inline": [
                "echo path is $PATH"
            ]
        }
    ]
}
